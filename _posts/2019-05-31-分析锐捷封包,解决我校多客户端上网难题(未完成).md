



## 开头

大家应该知道锐捷网络一直是一个坑，网络运营商不允许多客户端（多网卡/多用户/多设备）进行上网，导致配置docker，还有开启热点的时候困难重重，尽管有解决方案，但是对我来说并不是很合理，我日常使用linux作为开发环境，并且开启wifi热点。华中大学一位学生开发了mentohust，经过很多人接手之后，项目得到了很好的维护，算法也更新到了v4，但是在我的学校使用却不是那么顺利，于是通过分析网络封包发现是由于封包存在着和别人不通用的私有字段。给自己留下一个笔记，顺便学习网络的基础知识。

### TCPDUMP介绍

在windows系统上，wireshark是一个非常优秀的抓包工具，但是由于windows上有很多的应用程序发送和接受垃圾数据包，对于我分析MD5认证带来困扰，所以我在linux下分析

而在linux上，tcpdump和wireshark非常相似，而且还是自带的，对于我分析锐捷网络MD5认证有很大的帮助。

- tcpdump --version

  > tcpdump version 4.9.2
  > libpcap version 1.8.1
  > OpenSSL 1.1.1  11 Sep 2018

- tcpdump -h

  > Usage: tcpdump [-aAbdDefhHIJKlLnNOpqStuUvxX#] [ -B size ] [ -c count ]
  > 		[ -C file_size ] [ -E algo:secret ] [ -F file ] [ -G seconds ]
  > 		[ -i interface ] [ -j tstamptype ] [ -M secret ] [ --number ]
  > 		[ -Q in|out|inout ]
  > 		[ -r file ] [ -s snaplen ] [ --time-stamp-precision precision ]
  > 		[ --immediate-mode ] [ -T type ] [ --version ] [ -V file ]
  > 		[ -w file ] [ -W filecount ] [ -y datalinktype ] [ -z postrotate-command ]
  > 		[ -Z user ] [ expression ]

- tcpdump -n -i eth0 -w rjdump.pcap

  > No.   	 Source   		  Destination  			   Protool     			Info
  >
  > 1.    192.168.1.x    		10.0.1.5				TCP/SSH/ARP		...........		



### WIRESHARK介绍

​	查找后发现了wireshark存在linux版本，于是我折腾了起来。



### 锐捷认证过程和原理

在抓包之前，我们来分析以下 `mentohust/minieap` 的代码，以及认证方式



最后总结出来

![avatar](/Gah0.github.io/images/20191209/renzhengguocheng.png)

1. 发送请求认证 
2. 请求身份验证 
3. 回复身份认证请求 
4. 数据上传到服务端并验证身份正确 //服务器端进行
5. 服务端产生MD5种子  //服务器端进行
6. 请求密码验证 
7. 回复密码验证请求 
8. 数据上传到服务端并验证密码正确  //服务器端进行
9. 拨号认证成功产生成功信息  //服务器端进行
10. 返回成功信息



在linux环境下，一切比windows干净很多，安装wireshark后选择`eth0`网卡。



### 抓包

客户端选用linux下的锐捷客户端，因为它的数据结构相对稍稍简单些。成功认证之后得到以下这个图片的内容！

通过过滤  `eapol` 得到锐捷登录数据包

![avatar](/Gah0.github.io/images/20191209/2.png)

`length` 分别为 524, 539, 572，重点关注这几个。

![avatar](/Gah0.github.io/images/20191209/3.png)

![avatar](/Gah0.github.io/images/20191209/4.png)